{% extends 'layouts/base.html.twig' %}

{% set title = navbar.career ~ " | " ~ website.name %}

{% block body %}
    <!-- Career Section Heading-->
    <h2 class="page-section-heading text-center text-secondary text-uppercase font-weight-bold">{{ navbar.career }}</h2>
    <!-- Icon Divider-->
    <div class="divider-custom">
        <div class="divider-custom-line"></div>
        <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
        <div class="divider-custom-line"></div>
    </div>

    {% if not spectator %}
        <div class="width-fit-content mx-auto pb-3">
            <a href="{{ path('app_career_create', {externalId : user.externalId}) }}" class="mb-2 btn btn-primary-secondary">{{ button.add }}</a>
        </div>
    {% endif %}

    <div class="mb-5 p-3 bg-white rounded shadow">
        <div class="text-muted text-center">
            <span>
                <small>Double cliquez sur un élément pour plus d'information.</small>
            </span>
        </div>

        <div class="timeline-div" id="timeline"></div>
    </div>

    <input type="hidden" id="json_range_data" value="{{ json_range_data }}">
    <input type="hidden" id="json_moment_data" value="{{ json_moment_data }}">
    <input type="hidden" id="json_project_data" value="{{ json_project_data }}">
    <input type="hidden" id="external_id" value="{{ user.externalId }}">


    <div class="unselectable">
        {% for row in user.career|sort((a, b) => b.startDate <=> a.startDate)|batch(2) %}
        <div class="row">
            {% for career in row %}
            <div class="col-md-6 mb-4">
                <article id="{{ career.id }}" class="bg-white rounded shadow h-100 p-3">
                    <div class="article">
                        <h3 class="text-center text-secondary text-uppercase font-weight-bold pb-3 m-0">{{ career.title }}</h3>

                        {% if not spectator %}
                        <div class="width-fit-content mx-auto">
                            <a href="{{ path('app_career_update', {externalId : user.externalId, 'id' : career.id}) }}" class="mb-2 btn btn-primary">{{ button.update }}</a>
                            <a href="#" onclick="{{ 'event.preventDefault(); confirm(\'Veuillez confirmer la suppression\') && document.getElementById(\'js-career-delete-form-' ~ career.id ~ '\').submit();' }}" class="mb-2 btn btn-danger">{{ button.delete }}</a>
                        </div>
                        {% endif %}

                        <span class="title">Description</span>
                        <p class="text-justify">{{ career.description }}</p>
                    </div>
                    <div class="text-muted">
                        <small>
                            {% if career.endDate %}
                                {# Months between the two dates #}
                                {% set months = date(career.endDate).diff(date(career.startDate)).days//30 %}
                                De <b>{{ career.startDate|date("m/Y") }}</b> à <b>{{ career.endDate|date("m/Y") }}</b>
                                - <i>{{ months//12 ~ " an(s) et " ~ months%12 ~ " mois"}}</i>
                            {% else %}
                            Le <b>{{ career.startDate|date("d/m/Y") }}</b>
                            {% endif %}
                        </small>
                    </div>
                </article>

                {% if not spectator %}
                <form id="{{ 'js-career-delete-form-' ~ career.id }}" action="{{ path('app_career_delete', {externalId : user.externalId, 'id' : career.id}) }}" method="post" class="display-none">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token('career_deletion_' ~ career.id) }}">
                    <input type="hidden" name="_method" value="DELETE">
                </form>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
{% endblock %}